<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ryanair Flights</title>
    <meta name="description" content="View current Ryanair flight schedules and find your next departure. Real-time flight information with weekly schedule overview." />
    <meta name="keywords" content="Ryanair, flights, schedule, departures, arrivals, airline, travel" />
    <meta name="author" content="flights.robloxryanair.com" />
    <meta property="og:title" content="Ryanair Flights" />
    <meta property="og:description" content="View current Ryanair flight schedules and find your next departure. Real-time flight information with weekly schedule overview." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://flights.robloxryanair.com" />
    <meta property="og:site_name" content="Ryanair Flights" />
    <meta property="og:locale" content="en_GB" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ryanair Flights" />
    <meta name="twitter:description" content="View current Ryanair flight schedules and find your next departure. Real-time flight information with weekly schedule overview." />
    <meta name="theme-color" content="#1e40af" />
    <link rel="icon" href="https://flights.robloxryanair.com/harpyellow.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-900">
    <div class="min-h-screen flex flex-col">
      <header class="bg-blue-800 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <img src="https://flights.robloxryanair.com/harpyellow.png" alt="Ryanair" class="h-7 w-7" />
            <span class="text-lg sm:text-xl font-semibold tracking-wide">RYANAIR</span>
          </div>
          <nav class="hidden sm:flex items-center gap-3">
            <a href="#" class="text-sm/6 text-blue-100 hover:text-white">Roblox Group</a>
            <a href="#" class="text-sm/6 text-blue-100 hover:text-white">Discord</a>
            <a href="#" class="text-sm/6 bg-yellow-400 text-blue-900 rounded-full px-3 py-1 font-medium hover:bg-yellow-300">Careers</a>
            <a href="/admin.html" class="text-sm/6 text-blue-100 hover:text-white">Admin</a>
          </nav>
        </div>
      </header>

      <main class="flex-1">
        <section class="bg-gradient-to-b from-blue-50 to-gray-100">
          <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
            <div class="flex items-center gap-2 text-blue-800 font-medium">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="flex-none">
                <rect x="3" y="5" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                <path d="M16 3v4M8 3v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <span>Weekly Schedule</span>
            </div>

            <div id="tabs" class="mt-4 flex items-center gap-2 overflow-x-auto pb-2">
              <button id="prev-week" class="h-9 w-9 rounded-full border border-blue-200 text-blue-700 bg-white hover:bg-blue-50">‹</button>
              <div id="tabs-container" class="flex items-center gap-2"></div>
              <button id="next-week" class="h-9 w-9 rounded-full border border-blue-200 text-blue-700 bg-white hover:bg-blue-50">›</button>
            </div>

            <div class="mt-6 flex items-center gap-3 text-gray-900">
              <div id="selected-day-heading" class="text-lg font-semibold"></div>
              <span id="today-badge" class="hidden text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 border border-yellow-200">Today</span>
            </div>

            <div id="flights-container" class="mt-4 grid grid-cols-1 gap-4"></div>
          </div>
        </section>

        <div class="py-8 border-t mt-8 sm:py-12 bg-gray-50 border-gray-300">
          <div class="max-w-7xl mx-auto px-4 sm:px-6">
            <div class="flex flex-col items-center gap-4 sm:flex-row sm:justify-between">
              <div class="flex items-center gap-2">
                <img alt="Celestria Logo" width="25" height="25" src="https://flights.robloxryanair.com/celestria.png" />
                <span class="text-sm text-gray-700">2025 © Celestria Group</span>
              </div>
              <div class="flex flex-col items-center gap-3 sm:gap-4 sm:flex-row">
                <div class="flex gap-4 sm:gap-6">
                  <a class="text-sm hover:text-blue-700 hover:underline transition-colors text-gray-700" href="https://celestriagroup.com/privacypolicy.pdf" target="_blank" rel="noreferrer">Privacy Policy</a>
                  <a class="text-sm hover:text-blue-700 hover:underline transition-colors text-gray-700" href="https://celestriagroup.com/support" target="_blank" rel="noreferrer">Support Centre</a>
                </div>
                <p class="text-sm text-center text-gray-700">Roblox's Favourite Airline</p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      let allFlights = [];

      const container = document.getElementById('flights-container');
      const tabsContainer = document.getElementById('tabs-container');
      const selectedDayHeading = document.getElementById('selected-day-heading');
      const todayBadge = document.getElementById('today-badge');

      const operatorBadge = (op) => {
        const map = {
          ryanairdac: { text: 'Ryanair DAC', color: 'bg-blue-100 text-blue-800 border-blue-200' },
          buzz: { text: 'Buzz', color: 'bg-yellow-100 text-yellow-800 border-yellow-200' },
          malta: { text: 'Malta Air', color: 'bg-red-100 text-red-800 border-red-200' },
        };
        const m = map[op] || { text: op, color: 'bg-gray-100 text-gray-800 border-gray-200' };
        return `<span class="text-xs font-medium px-2.5 py-1 rounded-full border ${m.color}">${m.text}</span>`;
      };

      function renderCards(day) {
        container.innerHTML = '';
        const data = allFlights.filter(f => f.day === day).sort((a,b)=>a.departureTime.localeCompare(b.departureTime));
        data.forEach((f) => {
          const el = document.createElement('div');
          el.className = 'relative overflow-hidden border border-gray-200 rounded-2xl p-0 shadow-sm bg-white';
          el.innerHTML = `
            <div class="absolute inset-0 bg-[url('https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg')] bg-center bg-cover opacity-10"></div>
            <div class="relative">
              <div class="flex items-center justify-between px-4 pt-4">
                <div class="flex items-center gap-3">
                  <img src="https://flights.robloxryanair.com/harpyellow.png" alt="logo" class="h-5 w-5" />
                  <div class="text-sm text-gray-700">${f.operator === 'malta' ? 'Malta Air' : f.operator === 'buzz' ? 'Buzz' : 'Ryanair'}<span class="ml-2 uppercase text-gray-400">Flight</span></div>
                </div>
                <span class="text-xs px-3 py-1 rounded-full bg-blue-100 text-blue-800 border border-blue-200">${f.duration}</span>
              </div>
              <div class="px-4 pb-5 pt-3">
                <div class="grid grid-cols-2 items-center">
                  <div class="flex flex-col">
                    <div class="text-3xl font-semibold text-gray-900">${f.departureTime}</div>
                    <div class="mt-1 text-gray-700">${f.departure}</div>
                    <div class="text-xs text-gray-500">DEPARTURE</div>
                  </div>
                  <div class="flex flex-col items-end">
                    <div class="text-3xl font-semibold text-gray-900">${f.arrivalTime}</div>
                    <div class="mt-1 text-gray-700">${f.arrival}</div>
                    <div class="text-xs text-gray-500">ARRIVAL</div>
                  </div>
                </div>
              </div>
            </div>
          `;
          container.appendChild(el);
        });
      }

      function startOfWeek(date) {
        const d = new Date(date);
        const day = d.getDay();
        const diff = (day === 0 ? -6 : 1) - day;
        d.setDate(d.getDate() + diff);
        d.setHours(0,0,0,0);
        return d;
      }

      function formatTabDate(d) {
        const day = d.getDate().toString().padStart(2,'0');
        const month = d.toLocaleString('en-GB', { month: 'short' });
        const weekday = d.toLocaleString('en-GB', { weekday: 'long' });
        return { label: `${day} ${month}`, weekday };
      }

      function renderTabs(baseDate) {
        tabsContainer.innerHTML = '';
        const days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
        for (let i = 0; i < 7; i++) {
          const d = new Date(baseDate);
          d.setDate(baseDate.getDate() + i);
          const { label, weekday } = formatTabDate(d);
          const count = allFlights.filter(f => f.day === days[i]).length;
          const btn = document.createElement('button');
          btn.className = 'min-w-[130px] px-3 py-2 rounded-lg border bg-white text-blue-800 border-blue-200 hover:bg-blue-50';
          btn.innerHTML = `<div class="text-xs text-gray-500">${label}</div><div class="text-sm font-medium">${weekday}</div><div class="text-xs text-blue-700">${count} flights</div>`;
          btn.dataset.day = days[i];
          btn.addEventListener('click', () => selectDay(days[i], btn));
          tabsContainer.appendChild(btn);
        }
      }

      function selectDay(day, btn) {
        [...tabsContainer.children].forEach(c => c.className = 'min-w-[130px] px-3 py-2 rounded-lg border bg-white text-blue-800 border-blue-200 hover:bg-blue-50');
        btn.className = 'min-w-[130px] px-3 py-2 rounded-lg border bg-blue-700 text-white border-blue-700';
        const now = new Date();
        const weekStart = startOfWeek(now);
        const idx = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'].indexOf(day);
        const selectedDate = new Date(weekStart);
        selectedDate.setDate(weekStart.getDate() + idx);
        const dayLabel = selectedDate.toLocaleString('en-GB', { weekday: 'long' });
        const dateLabel = selectedDate.toLocaleString('en-GB', { day: 'numeric', month: 'short' });
        selectedDayHeading.textContent = `${dayLabel}, ${dateLabel}`;
        const isToday = selectedDate.toDateString() === now.toDateString();
        todayBadge.classList.toggle('hidden', !isToday);
        renderCards(day);
      }

      async function loadFlights() {
        const res = await fetch('/api/flights');
        allFlights = await res.json();
        const now = new Date();
        const base = startOfWeek(now);
        renderTabs(base);
        const defaultBtn = tabsContainer.children[4] || tabsContainer.children[0];
        selectDay(defaultBtn.dataset.day, defaultBtn);
      }
      loadFlights();
    </script>
  </body>
  </html>